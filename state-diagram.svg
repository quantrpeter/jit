<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 900" width="1100" height="900">
  <defs>
    <style>
      .state { fill: #E8F4F8; stroke: #2C3E50; stroke-width: 2; rx: 10; }
      .initial { fill: #2C3E50; }
      .final { fill: none; stroke: #2C3E50; stroke-width: 3; }
      .final-inner { fill: #2C3E50; }
      .text { fill: #2C3E50; font-family: 'Arial', sans-serif; font-size: 13px; }
      .state-name { fill: #2C3E50; font-family: 'Arial', sans-serif; font-size: 14px; font-weight: bold; }
      .transition { stroke: #2C3E50; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .transition-label { fill: #E67E22; font-family: 'Arial', sans-serif; font-size: 11px; font-style: italic; }
      .title { fill: #2C3E50; font-family: 'Arial', sans-serif; font-size: 22px; font-weight: bold; }
      .subtitle { fill: #34495E; font-family: 'Arial', sans-serif; font-size: 14px; }
      .composite { fill: #FFF9E6; stroke: #F39C12; stroke-width: 2; rx: 10; stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2C3E50"/>
    </marker>
  </defs>
  
  <!-- White Background -->
  <rect x="0" y="0" width="1100" height="900" fill="white"/>
  
  <!-- Title -->
  <text x="550" y="30" text-anchor="middle" class="title">JIT Compiler - State Diagram</text>
  <text x="550" y="50" text-anchor="middle" class="subtitle">Method Compilation Lifecycle</text>
  
  <!-- Initial State -->
  <circle cx="100" cy="100" r="15" class="initial"/>
  <text x="130" y="105" class="text">Initial</text>
  
  <!-- State: Uncompiled -->
  <rect x="50" y="150" width="180" height="80" class="state"/>
  <text x="140" y="175" text-anchor="middle" class="state-name">Uncompiled</text>
  <line x1="50" y1="185" x2="230" y2="185" stroke="#2C3E50" stroke-width="1"/>
  <text x="60" y="205" class="text">• Raw bytecode</text>
  <text x="60" y="220" class="text">• No analysis done</text>
  
  <path d="M 100 115 L 100 150" class="transition"/>
  
  <!-- State: Analyzing -->
  <rect x="300" y="150" width="180" height="100" class="state"/>
  <text x="390" y="175" text-anchor="middle" class="state-name">Analyzing</text>
  <line x1="300" y1="185" x2="480" y2="185" stroke="#2C3E50" stroke-width="1"/>
  <text x="310" y="205" class="text">• Parse bytecode</text>
  <text x="310" y="220" class="text">• Count operations</text>
  <text x="310" y="235" class="text">• Detect hot paths</text>
  
  <path d="M 230 190 L 300 190" class="transition"/>
  <text x="240" y="185" class="transition-label">analyze()</text>
  
  <!-- State: Analyzed -->
  <rect x="550" y="150" width="180" height="100" class="state"/>
  <text x="640" y="175" text-anchor="middle" class="state-name">Analyzed</text>
  <line x1="550" y1="185" x2="730" y2="185" stroke="#2C3E50" stroke-width="1"/>
  <text x="560" y="205" class="text">• Method info ready</text>
  <text x="560" y="220" class="text">• Hotness determined</text>
  <text x="560" y="235" class="text">• Optimization eligible</text>
  
  <path d="M 480 200 L 550 200" class="transition"/>
  <text x="490" y="195" class="transition-label">analysis complete</text>
  
  <!-- Decision Point: Hot or Cold -->
  <rect x="820" y="150" width="200" height="80" class="state"/>
  <text x="920" y="175" text-anchor="middle" class="state-name">Classification</text>
  <line x1="820" y1="185" x2="1020" y2="185" stroke="#2C3E50" stroke-width="1"/>
  <text x="830" y="205" class="text">• Check execution count</text>
  <text x="830" y="220" class="text">• Decide optimization</text>
  
  <path d="M 730 190 L 820 190" class="transition"/>
  <text x="740" y="185" class="transition-label">classify</text>
  
  <!-- State: Cold Path (No Optimization) -->
  <rect x="820" y="300" width="200" height="80" class="state"/>
  <text x="920" y="325" text-anchor="middle" class="state-name">Cold Method</text>
  <line x1="820" y1="335" x2="1020" y2="335" stroke="#2C3E50" stroke-width="1"/>
  <text x="830" y="355" class="text">• Basic compilation</text>
  <text x="830" y="370" class="text">• No optimizations</text>
  
  <path d="M 920 230 L 920 300" class="transition"/>
  <text x="930" y="270" class="transition-label">cold/infrequent</text>
  
  <!-- Composite State: Optimization (Hot Path) -->
  <rect x="50" y="300" width="700" height="280" class="composite"/>
  <text x="60" y="320" class="state-name">Optimization Process [Hot Methods]</text>
  
  <!-- Sub-state: Optimizing -->
  <rect x="70" y="340" width="200" height="90" class="state"/>
  <text x="170" y="365" text-anchor="middle" class="state-name">Optimizing</text>
  <line x1="70" y1="375" x2="270" y2="375" stroke="#2C3E50" stroke-width="1"/>
  <text x="80" y="395" class="text">• Inline methods</text>
  <text x="80" y="410" class="text">• Remove dead code</text>
  <text x="80" y="425" class="text">• Constant folding</text>
  
  <path d="M 920 230 L 920 260 L 170 260 L 170 340" class="transition"/>
  <text x="540" y="255" class="transition-label">hot/frequent method</text>
  
  <!-- Sub-state: Generating Code -->
  <rect x="320" y="340" width="200" height="90" class="state"/>
  <text x="420" y="365" text-anchor="middle" class="state-name">Generating Code</text>
  <line x1="320" y1="375" x2="520" y2="375" stroke="#2C3E50" stroke-width="1"/>
  <text x="330" y="395" class="text">• Emit bytecode/</text>
  <text x="330" y="410" class="text">  machine code</text>
  <text x="330" y="425" class="text">• Apply transforms</text>
  
  <path d="M 270 385 L 320 385" class="transition"/>
  <text x="275" y="380" class="transition-label">optimize</text>
  
  <!-- Sub-state: Code Generated -->
  <rect x="320" y="470" width="200" height="80" class="state"/>
  <text x="420" y="495" text-anchor="middle" class="state-name">Code Generated</text>
  <line x1="320" y1="505" x2="520" y2="505" stroke="#2C3E50" stroke-width="1"/>
  <text x="330" y="525" class="text">• Optimized code ready</text>
  <text x="330" y="540" class="text">• Metadata attached</text>
  
  <path d="M 420 430 L 420 470" class="transition"/>
  <text x="430" y="455" class="transition-label">generate</text>
  
  <!-- State: Compiled -->
  <rect x="300" y="650" width="220" height="100" class="state"/>
  <text x="410" y="675" text-anchor="middle" class="state-name">Compiled</text>
  <line x1="300" y1="685" x2="520" y2="685" stroke="#2C3E50" stroke-width="1"/>
  <text x="310" y="705" class="text">• Bytecode/Native ready</text>
  <text x="310" y="720" class="text">• Loaded in memory</text>
  <text x="310" y="735" class="text">• Executable</text>
  
  <path d="M 420 550 L 420 650" class="transition"/>
  <text x="430" y="605" class="transition-label">compilation done</text>
  
  <path d="M 920 380 L 920 610 L 520 610 L 520 650" class="transition"/>
  <text x="720" y="605" class="transition-label">skip optimization</text>
  
  <!-- State: Executing -->
  <rect x="600" y="650" width="200" height="100" class="state"/>
  <text x="700" y="675" text-anchor="middle" class="state-name">Executing</text>
  <line x1="600" y1="685" x2="800" y2="685" stroke="#2C3E50" stroke-width="1"/>
  <text x="610" y="705" class="text">• Method invoked</text>
  <text x="610" y="720" class="text">• Running optimized/</text>
  <text x="610" y="735" class="text">  native code</text>
  
  <path d="M 520 700 L 600 700" class="transition"/>
  <text x="530" y="695" class="transition-label">execute()</text>
  
  <!-- Profiling feedback loop -->
  <path d="M 700 650 L 700 620 L 640 620 L 640 250" class="transition" stroke-dasharray="3,3"/>
  <text x="645" y="440" class="transition-label">profile &amp;</text>
  <text x="645" y="455" class="transition-label">recompile</text>
  
  <!-- State: Cached -->
  <rect x="850" y="650" width="180" height="80" class="state"/>
  <text x="940" y="675" text-anchor="middle" class="state-name">Cached</text>
  <line x1="850" y1="685" x2="1030" y2="685" stroke="#2C3E50" stroke-width="1"/>
  <text x="860" y="705" class="text">• Stored for reuse</text>
  <text x="860" y="720" class="text">• Fast lookup</text>
  
  <path d="M 800 690 L 850 690" class="transition"/>
  <text x="805" y="685" class="transition-label">cache</text>
  
  <!-- Re-execution from cache -->
  <path d="M 940 650 L 940 630 L 700 630 L 700 650" class="transition" stroke-dasharray="3,3"/>
  <text x="805" y="640" class="transition-label">reuse</text>
  
  <!-- Final State -->
  <circle cx="940" cy="810" r="20" class="final"/>
  <circle cx="940" cy="810" r="14" class="final-inner"/>
  <text x="975" y="815" class="text">Final</text>
  
  <path d="M 940 730 L 940 790" class="transition"/>
  <text x="950" y="765" class="transition-label">cleanup</text>
  
  <!-- Legend -->
  <rect x="50" y="840" width="550" height="40" fill="none" stroke="#95A5A6" stroke-width="1"/>
  <text x="60" y="860" class="text" font-weight="bold">Legend:</text>
  <line x1="110" y1="865" x2="160" y2="865" class="transition"/>
  <text x="165" y="868" class="text" font-size="11px">State transition</text>
  <line x1="260" y1="865" x2="310" y2="865" class="transition" stroke-dasharray="3,3"/>
  <text x="315" y="868" class="text" font-size="11px">Feedback/Recompilation</text>
  <rect x="450" y="848" width="60" height="20" class="composite"/>
  <text x="515" y="861" class="text" font-size="11px">Composite state</text>
</svg>
